{% extends "base_template.html" %}
{% block page_title %}
Dispenser Management
{% endblock %}
{% block header_title %}
Dispenser Management
{% endblock %}
{% block head %}
    <script type="text/javascript">
<!--
    function toggle_visibility(id) {
       var e = document.getElementById(id);
      e.style.display = ((e.style.display!='none') ? 'none' : 'block');
    }
//-->
    </script>
{% endblock %}
{% block content %}
   {% load dispenser_tags %}
   
    <a href = "/compartment"> Update Compartments </a><br>
    <a href = "/loadcompartment"> Load Compartment into Dispenser </a><br>
    <a href = "/dispenser/admin">(Dispenser/Compartment Admin)</a><br>
    <hr>
    
    <h2>My Dispensers</h2><br>
   
   {% for dispenser in dispensers %}
      <a href="#" onclick="toggle_visibility('{{ dispenser.id }}');"><h4>{{ dispenser.location }}</h4></a>
      <div id = "{{ dispenser.id }}" style="display:none;">
      <ul>
      {% for compartment in dispenser.slots %}
         <li> Compartment {{ forloop.counter0 }} :
         {% if compartment %}
            {% with medName=compartment.rxuid|get_medName %}
               <br>
                  Medication: {{ medName }} <br>
                  Expiration: {{ compartment.expiration }} <br>
                  Lot Number: {{ compartment.lot }}<br>
                  <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="requestType" value="removeCompartment">
                    <input type="hidden" name="dispID" value="{{dispenser.id}}">
                    <input type="hidden" name="compID" value="{{compartment.id}}">
                    <input type="submit" value="remove compartment">
                  </form>
            {% endwith %}
         {% else %}
            OPEN
         {% endif %}
      {% endfor %}
      </ul>
      </div>
    {% endfor %}
{% endblock %} 